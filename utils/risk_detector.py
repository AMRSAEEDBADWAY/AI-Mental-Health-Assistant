"""
ูุธุงู ุงููุดู ุนู ุงููุฎุงุทุฑ ูุงูุฃุฒูุงุช
ูุญูู ุงููุตูุต ูููุดู ุนู ูุคุดุฑุงุช ุงูุงูุชุญุงุฑ ุฃู ุฅูุฐุงุก ุงูููุณ
"""

import re

class RiskDetector:
    def __init__(self):
        self.crisis_keywords = [
            "ุงูุชุญุงุฑ", "ุฃููุช", "ุฃููู ุญูุงุชู", "ุฃูุชู ููุณู", "ูุด ุนุงูุฒ ุฃุนูุด",
            "ุฎูุงุต ุชุนุจุช", "ูููุด ูุงูุฏุฉ", "ุจูุฑู ุญูุงุชู", "ุนุงูุฒ ุงุฑุชุงุญ",
            "suicide", "kill myself", "die", "end my life"
        ]
        
        self.high_risk_patterns = [
            r"(ุนุงูุฒ|ุนุงูุฒ|ุจููุฑ) (ุฃููุช|ุฃูุชุญุฑ|ุฃุฎูุต ูู ุญูุงุชู)",
            r"(ูุด (ูุงุฏุฑ|ุนุงูุฒ)) (ุฃููู|ุฃุนูุด)",
            r"(ุญูุงุชู (ูููุงุด|ุจุฏูู) (ูุนูู|ูููุฉ|ูุฒูู))"
        ]

    def detect_risk(self, text):
        """
        ูุญุต ุงููุต ูููุดู ุนู ุงููุฎุงุทุฑ
        Returns:
            dict: {
                'is_risk': bool,
                'level': 'high' | 'medium' | 'low' | 'none',
                'reason': str
            }
        """
        text_lower = text.lower()
        
        # 1. ูุญุต ุงูุฃููุงุท ุนุงููุฉ ุงูุฎุทูุฑุฉ (Regex)
        for pattern in self.high_risk_patterns:
            if re.search(pattern, text_lower):
                return {
                    'is_risk': True,
                    'level': 'high',
                    'reason': 'ุชู ุฑุตุฏ ุนุจุงุฑุงุช ุชุดูุฑ ูุฑุบุจุฉ ูุจุงุดุฑุฉ ูู ุฅููุงุก ุงูุญูุงุฉ'
                }

        # 2. ูุญุต ุงููููุงุช ุงูููุชุงุญูุฉ
        matches = [word for word in self.crisis_keywords if word in text_lower]
        if len(matches) > 0:
            # ุฅุฐุง ูุงู ููุงู ุฃูุซุฑ ูู ูููุฉ ููุชุงุญูุฉุ ูุนุชุจุฑู ุฎุทุฑ ูุชูุณุท/ุนุงูู
            level = 'high' if len(matches) > 1 else 'medium'
            return {
                'is_risk': True,
                'level': level,
                'reason': f"ุชู ุฑุตุฏ ูููุงุช ููููุฉ: {', '.join(matches)}"
            }

        return {
            'is_risk': False,
            'level': 'none',
            'reason': ''
        }

    def get_crisis_response(self):
        """ุฑุณุงูุฉ ุทูุงุฑุฆ ููุญุฏุฉ"""
        return """
        โ๏ธ **ุชูุจูู ูุงู ุฌุฏุงู**
        
        ุฃูุง ููุง ุนุดุงู ุฃุณูุนู ูุฃุณุงุนุฏูุ ููู ุฃูุง ูุฌุฑุฏ ุจุฑูุงูุฌ ุฐูุงุก ุงุตุทูุงุนู.
        ุงูููุงู ุงููู ุจุชูููู ุฏู ููู ุฌุฏุงู ููุญุชุงุฌ ุญุฏ ูุชุฎุตุต ูุณูุนู ุญุงูุงู.
        
        ุฃุฑุฌููุ ูู ุญุงุณุณ ุฅูู ูููู ุชุฃุฐู ููุณูุ ุงุชุตู ุญุงูุงู ุจู:
        ๐ **ุงูุฎุท ุงูุณุงุฎู ููุฏุนู ุงูููุณู ูู ูุตุฑ: 08008880700**
        ๐ **ุฃู ุงูุฅุณุนุงู: 123**
        
        ุญูุงุชู ุบุงููุฉ ููููุฉุ ูููู ูุงุณ ูุชูุฑ ูุณุชุนุฏุฉ ุชุณุงุนุฏู ูุชุณูุนู ุฏูููุชู.
        ูููู ูุชููู ูู ุฃู ุญุงุฌุฉ ุชุงููุฉุ ุจุณ ุฃุฑุฌูู ุงุทูุจ ุงููุณุงุนุฏุฉ ุงููุชุฎุตุตุฉ ุฏู.
        """
